<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Manager New Request</title>
  <link rel="stylesheet" href="../css/style.css">
</head>

<body>
  <div class="container">
    <div class="header">
      <h2>New Travel Request (Manager)</h2>
      <nav><a href="info.html">My Info</a><a href="all_requests.html">My Requests</a><a
          href="create_employee.html">Create Employee</a><a href="approve_requests.html">Approve Requests</a><a
          class="logout" href="#" onclick="logout()">Logout</a></nav>
    </div>
    <div id="formArea">
      <label>Reason</label><textarea id="reason"></textarea>
      <label>Estimated Cost</label><input id="est_cost" type="number" step="0.01">
      <h4>Itinerary</h4>
      <label>Type</label><input id="it_type">
      <label>From</label><input id="from_city"><label>To</label><input id="to_city">
      <label>Start Date</label><input id="start_date" type="date"><label>End Date</label><input id="end_date"
        type="date">
      <label>Cost</label><input id="it_cost" type="number" step="0.01">
      <label>Notes</label><input id="it_notes">
      <button id="submit" class="small">Submit</button>
      <div id="msg" style="display:none" class="message"></div>
    </div>
  </div>
  <script src="../js/mock_data.js"></script>
  <script src="../js/shared.js"></script>
  <script>
    (function () {
      const u = getLoggedIn(); if (!u) { location = '/index.html'; return; }
      document.getElementById('submit').addEventListener('click', function () {
        const reason = document.getElementById('reason').value.trim(); const est = parseFloat(document.getElementById('est_cost').value) || 0;
        if (!reason) { alert('Enter reason'); return; }
        const data = getStoredData();
        const newId = (data.requests.reduce((m, r) => Math.max(m, r.request_id || 0), 0) || 0) + 1;
        const req = { request_id: newId, employee_id: u.employee_id, request_date: new Date().toISOString().slice(0, 10), reason: reason, status: 'PENDING', estimated_cost: est, approver_id: null, approval_date: null };
        data.requests.push(req);
        const itId = (data.itineraries.reduce((m, it) => Math.max(m, it.itinerary_id || 0), 0) || 0) + 1;
        const it = { itinerary_id: itId, request_id: newId, type: document.getElementById('it_type').value || 'FLIGHT', departure_city: document.getElementById('from_city').value || '', arrival_city: document.getElementById('to_city').value || '', start_date: document.getElementById('start_date').value || '', end_date: document.getElementById('end_date').value || '', cost: parseFloat(document.getElementById('it_cost').value) || 0, notes: document.getElementById('it_notes').value || '' };
        data.itineraries.push(it); Object.assign(MOCK_DATA, data); persistData();
        document.getElementById('msg').style.display = 'block'; document.getElementById('msg').textContent = 'Request created id=' + newId; setTimeout(() => location = 'all_requests.html', 800);
      });
    })();
  </script>
</body>

</html>