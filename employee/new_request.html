<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>New Request</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/style.css">
</head>

<body>
  <div class="container">
    <div class="header">
      <h2>New Travel Request</h2>
      <nav>
        <a href="info.html">My Info</a>
        <a href="all_requests.html">My Requests</a>
        <a class="logout" href="#" onclick="logout()">Logout</a>
      </nav>
    </div>
    <div id="formArea" class="card">
      <div class="card-header">
        <h3 class="card-title">Create New Travel Request</h3>
      </div>
      <div class="form-group">
        <label>Reason</label>
        <textarea id="reason" placeholder="Enter reason for travel"></textarea>
      </div>
      <div class="form-group">
        <label>Estimated Cost (₹)</label>
        <input id="est_cost" type="number" step="0.01" placeholder="0.00">
      </div>
      
      <div class="card">
        <div class="card-header">
          <h4 class="card-title">Itinerary Details</h4>
        </div>
        <div class="form-group">
          <label>Type (FLIGHT/HOTEL/TRAIN)</label>
          <input id="it_type" placeholder="FLIGHT">
        </div>
        <div class="form-group">
          <label>From City</label>
          <input id="from_city" placeholder="Departure city">
        </div>
        <div class="form-group">
          <label>To City</label>
          <input id="to_city" placeholder="Arrival city">
        </div>
        <div class="form-group">
          <label>Start Date</label>
          <input id="start_date" type="date">
        </div>
        <div class="form-group">
          <label>End Date</label>
          <input id="end_date" type="date">
        </div>
        <div class="form-group">
          <label>Cost (₹)</label>
          <input id="it_cost" type="number" step="0.01" placeholder="0.00">
        </div>
        <div class="form-group">
          <label>Notes</label>
          <input id="it_notes" placeholder="Additional notes">
        </div>
      </div>
      
      <button id="submit" class="btn success">Submit Request</button>
      <div id="msg" style="display:none" class="message"></div>
    </div>
  </div>
  <script src="../js/mock_data.js"></script>
  <script src="../js/shared.js"></script>

<script>
  (function () {
    const u = getLoggedIn();
    if (!u) { location = '/index.html'; return; }

    document.getElementById('submit').addEventListener('click', function (e) {
      e.preventDefault();

      // Remove old errors
      document.querySelectorAll('.error-text').forEach(el => el.remove());

      let valid = true;

      // Helper to show error beside field
      function showError(id, msg) {
        const input = document.getElementById(id);
        const error = document.createElement('span');
        error.className = 'error-text';
        error.style.color = 'red';
        error.style.marginLeft = '10px';
        error.textContent = msg;
        input.parentNode.insertBefore(error, input.nextSibling);
        valid = false;
      }

      // Get values
      const reason = document.getElementById('reason').value.trim();
      const estCost = document.getElementById('est_cost').value.trim();
      const type = document.getElementById('it_type').value.trim().toUpperCase();
      const fromCity = document.getElementById('from_city').value.trim();
      const toCity = document.getElementById('to_city').value.trim();
      const startDate = document.getElementById('start_date').value;
      const endDate = document.getElementById('end_date').value;
      const itCost = document.getElementById('it_cost').value.trim();

      // Simple field checks
      if (!reason) showError('reason', 'Required');
      if (!estCost || isNaN(estCost) || estCost <= 0) showError('est_cost', 'Invalid cost');
      if (!type || !['FLIGHT', 'HOTEL', 'TRAIN'].includes(type)) showError('it_type', 'Use FLIGHT/HOTEL/TRAIN');
      if (!fromCity) showError('from_city', 'Required');
      if (!toCity) showError('to_city', 'Required');
      if (!startDate) showError('start_date', 'Select start date');
      if (!endDate) showError('end_date', 'Select end date');
      if (startDate && endDate && new Date(startDate) > new Date(endDate)) showError('end_date', 'End date before start');
      if (!itCost || isNaN(itCost) || itCost <= 0) showError('it_cost', 'Invalid cost');

      // Show bottom message
      const msg = document.getElementById('msg');
      msg.style.display = 'block';
      if (valid) {
        msg.textContent = '✅ Form is valid! (No data will be saved)';
        msg.className = 'message success';
      } else {
        msg.textContent = 'Please fix the errors above.';
        msg.className = 'message error';
      }
    });
  })();
</script>

</body>

</html>